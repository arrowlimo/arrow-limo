services:
  - type: web
    name: arrow-limousine-api
    runtime: python
    pythonVersion: 3.11
    
    # Build command
    buildCommand: |
      pip install --upgrade pip setuptools wheel
      pip install -r modern_backend/requirements.txt
      cd frontend && npm install && npm run build && cd ..
    
    # Start command - runs FastAPI backend
    startCommand: |
      uvicorn modern_backend.app.main:app \
        --host 0.0.0.0 \
        --port $PORT \
        --workers 4
    
    # Environment variables
    envVars:
      # Database - Points to Neon
      - key: DB_HOST
        value: ep-curly-dream-afnuyxfx-pooler.c-2.us-west-2.aws.neon.tech
      - key: DB_NAME
        value: neondb
      - key: DB_USER
        value: neondb_owner
      - key: DB_PASSWORD
        sync: false
        # Provide in Render dashboard: npg_89MbcFmZwUWo
      - key: DB_SSLMODE
        value: require
      - key: DB_PORT
        value: 5432
      
      # API Configuration
      - key: API_HOST
        value: 0.0.0.0
      - key: API_PORT
        value: $PORT
      - key: ENVIRONMENT
        value: production
      
      # Session
      - key: SESSION_TIMEOUT_MINUTES
        value: 30
      - key: MAX_LOGIN_ATTEMPTS
        value: 5
      - key: LOGIN_LOCKOUT_MINUTES
        value: 15
      
      # Square (production keys)
      - key: SQUARE_ACCESS_TOKEN
        sync: false
        # Provide in Render dashboard
      - key: SQUARE_ENV
        value: production
    
    # Health check
    healthCheckPath: /health
    
    # Disk size (optional - depends on Render plan)
    disk:
      name: data
      mountPath: /data
      sizeGB: 10
    
    # Resources (adjust based on usage)
    plan: starter
    
    # Auto-deploy on push
    autoDeployOnPush: true
    autoDeploy:
      branch: main
    
    # Build cache
    buildCache: true
    
    # Log drains (optional - for monitoring)
    logDrains: []

# Database - Neon (managed externally)
# Connection string: 
# postgresql://neondb_owner:PASSWORD@ep-curly-dream-afnuyxfx-pooler.c-2.us-west-2.aws.neon.tech:5432/neondb?sslmode=require
